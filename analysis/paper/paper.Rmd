---
title: "Change in Mobility and Site Occupation during the Late Pleistocene in Korea"
author:
  - Author Gayoung Park
  - Author Ben Marwick
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::html_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  The Late Pleistocene saw the introduction of new lithic technologies to the Korean Peninsula, especially stemmed points and blades. We examined stone artifacts from 22 sites in Korea to investigate how the introduction of  new tools changed the way people used the landscape, and the way people used sites. We analyzed artifact density, retouch frequency, radiocarbon ages, site elevation, raw material types, and composition of the toolkit to test hypotheses about site use. The results show that the new technology enabled the occupation of marginal environments at higher elevations. We find no strong relationship between technology and ecological change. Instead, we assume that population dynamics might have had more impact on changes in stone artifact technology and hunter-gatherer subsistence. 
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---


<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r, setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/"
)

#library(koreapaleolithicmobilityoccupation)# Or use devtools::load_all('.', quiet = T) if your code is in script files, rather than as functions in the `/R` diretory
```

```{r setup, include=FALSE}
suppressMessages(library(tidyverse))
library(glue)
library(ggrepel)

# data from PhD data sheet, not KAS sheet.
mydata <- read.csv("~/koreapaleolithicmobilityoccupation/General_info.csv")

# raw material data from KAS data sheet.
kasr <- read.csv("~/koreapaleolithicmobilityoccupation/Rawmaterial_info.csv")

# assemblage composition data from KAS data sheet.
kasa <- read.csv("~/koreapaleolithicmobilityoccupation/Assemblage_info.csv")

#volume of the cultural layer from KAS data sheet.
kasv <- read.csv("~/koreapaleolithicmobilityoccupation/Dating_info.csv")

dates <- read.csv("~/koreapaleolithicmobilityoccupation/Radiocarbon dates.csv")

```
# Introduction

Stone artifact assemblages have important information about hunter-gatherer mobility and subsistence strategy, according to the behavioral ecological theory that links technological changes to human adaptation to the surrounding environment. Our research focuses on technological change during the Late Pleistocene in Korea, around ~40-35 ka. We examined stone artifacts from 22 sites in South Korea to investigate the technological transition represented by the appearance of a new tool, stemmed points, and the following blade industry. The overall aim is to understand how the appearance of stemmed points affected hunter-gatherers in Korea, which leads to three specific questions to pursue: how did the introduction of the new tools change the way people used the landscape, the way people used sites, and the population. This technological change has been studied related to the issues of the transition from the Early to the Late Paleolithic and the migration of Homo sapiens. However, the studies rarely consider the relationship between the technological transition and change in human subsistence strategies. The most Korean Paleolithic sites do not preserve much information to understand hunter-gatherers or the transition in their tool kit due to a lack of material evidence. Therefore, we apply theoretical hypotheses to understand the relationship between hunter-gatherers, technology, and the environment. Using Human Behavioral Ecology (HBE) driven models, we hypothesized that hunter-gatherers should move frequently and further in order to adapt to a changing environment, so their tools became more portable and efficient, as indicated by decreases in the size of both individual tools and toolkit and increases in function and utility.  


# Background

```{r demo, eval = FALSE}
1 + 1
```

## Theory and background to our three questions

New technologies have led people to adjust the speed and frequency of mobility, explore the new landscape, or even manage the population size of the foraging group or overall population occupied one region. Previous studies show that new technologies play an important role in the change in the use of the landscape. For instance, Morisaki et al. argue that the transition of the blades and points becoming dominant over trapezoid in toolkits around 25 ka cal BP in north Paleo-Honshu Island enabled the foragers to extend their occupation at residential sites [@Morisaki_Izuho_Terry_Sato_2015]. In Australia during the mid-Holocene, the highly retouched and finely shaped tools with shafts appeared to reduce risks of being in a different environment so that they could broaden their occupations to offshore islands on the northeast and northwest coast [@Hiscock_1994]. New tools tend to appear as a risk reduction strategy when they confront an unfamiliar environment mainly caused by climate change, migration to previously unoccupied landscapes, based on the understanding of resource distribution, tool manufacturing process, and the characteristics of the foraging group. The appearance of microliths as portable and standardized tools is a great example to show that people made new tools to increase multi-functionality and tool readiness so that they can minimize the economic risk and/or scheduling difficulties [@Hiscock_Clarkson_Mackay_2011]. 

The rapid spread of microblade industry in north China among Last Glacial Maximum demonstrates that making new tools was one of the human adaptation to extremely cold environment by increasing mobility or meeting the new demands such as the production of sophisticated cold-weather clothing [@Barton_Brantingham_Ji_2007; @yi2013microblade; @Qu_Bar-Yosef_Wang_Wu_2013; @nian2014chronology].

The explanation of the emergence of new tools as an aid of buffering risks, as a result of environmental change, is one of the main concepts of Human Behavioral Ecology (HBE). HBE focuses on understanding patterned human behaviors, such as the ways they evaluate choices in food procurement, mobility, division of labor, task-group membership, social affiliation, prestige, and social subordination, to selective pressures in the environment [@smith2017natural; @smith2017three; @fitzhugh2001risk; @bird2006behavioral; @fitzhugh2019human; @Veile_2018]. Thus, most HBE models investigate environmental variables (e.g., resource density, competitor frequency) and behaviors reflecting decisions that people made about how to allocate time and energy to their activities [@smith2017three; @bird2006behavioral; @kelly1995foraging; @Creanza_Kolodny_Feldman_2017; @fitzhugh2019human]. HBE provides concepts to identify how foragers adjust their technologies, resource management strategies, schedule movements, foraging, food processing (including storage and consumption), and investment in technologies to optimize time and energy [@kelly1995foraging]. Stone artifacts have also been used in HBE models to understand hunter-gatherers’ mobility and site occupation patterns [@Marwick_2013; @Clarkson_2013; @capriles2018mobility]. For example, Clark and Barton (2017) examined to investigate resource acquisition strategies of hunter-gatherers by means of stone artifact density and the frequency of retouched pieces (scaled to the volume of excavated sediment) as proxies to represent occupation patterns such as ‘logistically organized basecamp’ and ‘short-term camp’. We use HBE as a reference framework to answer the three questions: (1) how did the introduction of the stemmed points and blade industry change the way people used the landscape? (2) was there any change in the way people used sites? (3) was there any population change and did it impact on technology or subsistence pattern?

## Regional Archaeology

Northeast Asia/similar studies and previous research in the adjacent regions : General description of EUP in East Asia

The technological change during the Late Pleistocene in Northeast Asia has been actively studied related to the topic of modern human dispersal to the East and chronological transition from Middle to Upper Paleolithic [or Early to Late Paleolithic. In Northeast Asia, the term and concept of ‘Late Paleolithic ’ is widely used rather than ‘Upper Paleolithic’ related to the absence of Middle Paleolithic industry such as Levallois [@gao2002critique; @Bar-Yosef_2002; @mellars2007rethinking; @norton2009evolution; @norton2009east; @lee2013current]]. Along with the modern human dispersal, this transition often comes with the appearance of blade and micro technology, high frequencies of retouched blade tools, several novel refined tools such as projectile points, end scrapers, burins, denticulates, etc, and using high-quality raw materials [@bar1999big; @brantingham2001initial; @Bar-Yosef_2002; @bae2017origin; @nakazawa2018quaternary]. 

In China, the transition from the Middle to the Upper Paleolithic dates to 35-30 ka appeared with a few body decorations, bone tools, core-and-flake in North and cobble tools in South. In addition to the technological changes, the use of symbols in the body decorations reflects social and cultural changes occurred during the onset of the Chinese Upper Paleolithic [@qu2013chinese; @peng2018onset]. At the Shuidonggou site in northern China which is considered as a typical site for showing the transition from cobble to blade tool industries in Northeast Asia [@Brantingham_Perreault_2010; @Gao_Zhang_Yang_Shen_Wu_2010; @pei2012shuidonggou], newly discovered localities (SDG 2, 7-12) show various aspects of the initial Late Paleolithic from 32,000 BP to 6000 BP. Some sites (SDG 9, 12) have blades and bladelets made of higher quality or exotic raw materials in addition to more than 80 polished ostrich egg-shell beads (SDG 2), bone needles and an awl (SDG 12), while other sites have mostly small, irregular flakes [@Gao_Zhang_Yang_Shen_Wu_2010]. The transition to the Upper Paleolihtic in Japan is under the long term debate due to the uncertainty about the existence of the previous period in the Archipelago. But there are several features represent the milestone of the new era such as systematic procurement and reduction of lithic raw materials, trap-pit hunting method, watercraft (maritime transport), bow-and-arrow technology, and standardization of lithic tools which can show the appearance of new subsistence strategies possibly driven by risks of increased population and ecological change [@Yamaoka_2012; @bae2017origin; @Nakazawa_Bae_2018; @morisaki2019early]. The technological transition in Korea is mainly characterized by the early appearance of stemmed points and following blade technology. Using the blade as a blank, the stemmed points became more standardized and increased in number. The flake tools became more sophisticated, with a greater diversity in both type and size along with continuously used core tools during the Upper Paleolithic [@Bae_2010; @Lee_2013; @Lee_2016]. 

In this research, we choose to focus on the technological transition and its impact on mobility and site occupation pattern in Korea because of the uniqueness of sudden and earliest appearance of stemmed points among the broad area of Northeast Asia during the Late Pleistocene. The oldest stemmed points so far is from the Yongho-dong site dated to 38.5 ka [@seong2009emergence; #### Park 2012 ####; @seong2015diversity; @bae2017origin]. The stemmed point is a projectile point made out of elongated flake or blade and with gentle retouch on the proximal end to shape an acute tip and on the distal end to make a stem, which connects to a shaft. Combining with the blade industry, the shape became more standardized with one or two ridges on dorsal side and triangular horizontal cross section. The stemmed point is often called as a tanged point, but we prefer to use stemmed point to distinguish with other stone projectile points of Bronze age in Korea, also called as a tanged point in English literature. The early appearance of the stemmed points in the Korean Peninsula brings about several issues to consider such as issues of human migration or advanced cognitive ability to make a new tool adapting to the surrounding environment. As a part of composite implements such as arrowheads or spearheads, the point was combined with other materials and it could be easily replaced reducing waste of total disposal [@Keeley_1982; @kuhn2015artifacts]. The new projectile point also indicates a new way of hunting methods or other subsistence strategies because the throwing technique enables to earn a long-distance target. In addition, this new tool spread to adjacent regions such as Japanese Archipelago by combination of watercraft technique and social network so that the study of stemmed points play an important role in understanding about peopling in Japan and the relationship between the Peninsula and Archipelago. This project focuses on the functional aspect to understand the technology and subsistence pattern based on the concept of HBE.  


# Methods

Sites and dates

The data analyzed in this paper are gathered from published excavation reports of 22 Paleolithic sites (33 cultural layers) in South Korea dating from 49k BP to 24k BP. After the first excavation at Jeongokri site in the late 1970s, more than 200 Paleolithic sites are discovered in Korea. Among them, we  chose 22 sites based on the existence of absolute dates that span our period of interest. We include sites dated before and after the transition period (40-35 ka) to analyze the process of technological transition. 

```{r cache = TRUE, fig.cap="Map of sites discussed in the text."}
library(here)

korean_archaeological_sites <- readxl::read_excel(here("analysis/data/raw_data/korean-archaeologica-sites.xlsx"))

library(tidyverse)

coords <- 
	korean_archaeological_sites %>% 
	select(site_name, 
				 east_longitude, 
				 north_latitude) %>% 
	separate(east_longitude, 
					 into = c("e_deg", "e_min", "e_sec"),
					 sep =  "°|\\′") %>% 
	mutate(e_min = str_squish(e_min),
				 e_sec = str_squish(e_sec)) %>% 
	separate(e_min, 
					 into = c("e_min", "e_sec1"), 
					 sep = "'") %>% 
	mutate_at(vars(e_deg, e_min, e_sec, e_sec1), parse_number) %>% 
	mutate(e_sec = ifelse(is.na(e_sec), e_sec1, e_sec)) %>% 
	select(-e_sec1) %>% 
	separate(north_latitude, 
					 into = c("n_deg", "n_min", "n_sec"),
					 sep =  "°|\\′") %>% 
	mutate(n_min = str_squish(n_min),
				 n_sec = str_squish(n_sec)) %>% 
	separate(n_min, 
					 into = c("n_min", "n_sec1"), 
					 sep = "'") %>% 
	mutate_at(vars(n_deg, n_min, n_sec, n_sec1), parse_number) %>% 
	mutate_if(is.numeric, list(~ifelse(is.na(.), 0, .))) %>% 
	mutate(n_sec = ifelse(is.na(n_sec), n_sec1, n_sec)) %>% 
	select(-n_sec1) %>% 
	mutate(lat_dms =  str_glue('{n_deg} {n_min} {n_sec}'),
				 long_dms = str_glue('{e_deg} {e_min} {e_sec}')) %>% 
	# convert from decimal minutes to decimal degrees
	mutate(lat_dd = measurements::conv_unit(lat_dms, 
																			 from = 'deg_min_sec', 
																			 to = 'dec_deg')) %>% 
	mutate(long_dd = measurements::conv_unit(long_dms, 
																				from = 'deg_min_sec', 
																				to = 'dec_deg')) %>% 
	mutate_at(vars(lat_dd, long_dd), as.numeric)

# quick map

library(ggmap)

# bounding box
# 39.534214, 124.159154 ... 39.657415, 129.138604
# 33.694662, 123.491142 ... 34.338454, 130.569658

map <- 
	get_stamenmap(bbox = c(left = 123, 
												 bottom = 33, 
												 right = 	131, 
												 top = 39),
								zoom = 10)

library(ggrepel)
ggmap(map)  + geom_point(data = coords,
						 aes(long_dd ,
						 		lat_dd), 
						 colour = "red",
						 size = 2) +
	geom_label_repel(data = coords,
									aes(long_dd ,
											lat_dd,
											label = site_name),
									size = 2) 

ggsave(here("analysis/figures/site-map.png"))

# pick points off this map with korea_boundary <- locator()

korea_bb <-  
	data.frame(x = c(125, 
						       130, 
						       130, 
						       125), 
			 y = c(38, 
			 			 38, 
			 			34, 
			 			34))
```

Assemblages

The research analyzes total 33 assemblages [need to explain what is the difference between 'assemblage' and 'site'] and they consist of cores, blade cores, blades, flakes, debris, hammers, choppers, plans, polyhedrals, side scrapers, end scrapers, notches, cleavers, stemmed points, awls, denticulates, burins, handaxes, blanks, knives, handadzes, peaks, flatters, flakers etc, 

Some artifacts are not included as certain tools due to their vague or broken shape presumably related to the characteristics of raw materials such as quartz, quartz vein, and quartzite. In that case, we named them as unknown, unfinished, or pebble. The stone artifacts from all of these sites are stored in museums located throughout South Korea, and have been briefly described in the excavation reports. We have visited most of these collections, collected PDFs of the excavation reports, and negotiated permission to study the materials. For example, the Hwadae-ri site has three cultural layers. The lowest horizon at the bottom, dated to 39,000±1400 BP by OSL, contains coarse flake tools made of vein quartz and quartzite. The middle cultural horizon has stemmed points made of porphyry, with quartz and quartzite dominating the assemblage. This layer dated to 31,200±900 BP by radiocarbon dating and 30,000±1,700 BP by OSL. The uppermost layer, dated to 22,000±100 BC by OSL, contains blades, scrapers, awls, and denticulates [@seong2009emergence]. We compare the assemblages from the two older layers at this and other sites to investigate the transition process.     

Statistical methods 

To answer the three research questions, we gather information such as elevation of the sites, artifact density, retouch frequency, radiocarbon dates toolkit composition, and raw material type. The elevation is the main proxy for environmental information in this research. The Korean paleoenvironmental data and information are not rich enough to directly apply HBE driven models or questions [####Han 2008####; @Chang_2013]. Rather, the paleoenvironment of the Korean Peninsula for this proposed research time period can be simply summarized as ‘overall cooler and drier during MIS 3’ [###Han 2008###; ####Seong 2008####; ###Choi 2011####; @Chang_2013; @im2015study; @bak2017late]. In this regard, it is much harder to understand the regional as well as shorter-time scale of paleoenvironmental change in the Korean Peninsula. In addition, the targeting period is not exactly matched with major environmental changes that we can check through global sea level change, it seems rather monotonous around 40-35 ka [@Bailey_2010; @Lorscheid_Stocchi_Casella_Gómez-Pujol_Vacchi_Mann_Rovere_2017]. In this research, we chose elevation to make a premise that the site elevation can represent different environment in local scale and hunter-gatherers moved to different elevation as a result of environment related risk. This research focuses on the change of the elevation of the sites throughout time and accompanying toolkits, and its relationship with the appearance of new tools.

The artifact volumetric density is defined as the total number of artifacts per cubic meter of excavated sediment, and served as a proxy for accumulation ratio of artifacts [@clark2017lithics; @clark2019landscapes]. We expected to use this value to evaluate mobility and land-use practices of hunter-gatherers during the Late Pleistocene. We count the retouch frequency as the number of retouched tools divided by the total number of artifacts. This value represents general proficiency of lithic manufacturing, raw material availability, and subsistence strategies including mobility and duration of site occupation based on the concept that tool reductioning is an economical tactic to generate sharp, usable edges while minimizing the cost of transporting tools or bulky raw materials by reducing the total load weight [@Kuhn_1990; @clark2019landscapes]. In other words, producing and carrying highly retouched tools will increase portability and efficiency by decrease in the size of both individual tools and the assemblages so that hunter-gatherers could move often or further, or both [@kuhn1991unpacking; @kuhn1994formal; @kuhn2004upper; @andrefsky1994raw; @davies2018modeling]. For example, highly retouched and finely shaped implements appeared in Australia during the mid-Holocene to minimize risk associated with environmental change and high mobility [@Hiscock_1994].

Combined the two proxies, the artifact volumetric density and the retouch frequency, we expect to determine whether or not the hunter-gatherers were residentially mobile or logistically organized. If the assemblage in a site has high density and less retouched, it is depicted as expedient assemblage that represents “base camps” or “residences”, while less density with high retouched one shows curated assemblage and indicates either residential mobility or certain task groups from main residential site [@Riel-Salvatore_Barton_2004; @clark2017lithics].

Radiocarbon dates provide a proxy for change in human population levels. Summed probability distributions (SPD) of radiocarbon dates are often used to understand temporal trends in ancient human populations [@rick1987dates; @bamforth2012radiocarbon; @shennan2013regional; @timpson2014reconstructing; @contreras2014summed]. Even though there must be unavoidable limitations for the validity of SPD such as the lack of excavated sites in certain period, this method is still helpful to be used as a proxy for population fluctuation. Timpson et al. demonstrate its usefulness by testing data sets in 12 European regions and assert that this SPD is extremely robust to deal with small sample size [@timpson2014reconstructing]. We use 171 radiocarbon dates from 22 sites to search for population trends during the Late Pleistocene in Korea based on the premise that population change or pressure could be another catalyst to improve or innovate technology.      

In terms of the composition of toolkits, we count kind of tools as well as the amount of debitabitage to search for the change in the toolkits around the transition period. The tools represent paleo hunter-gatherers’ adaptive strategies. We analyze the composition of raw materials in the assemblages to see the relationships between the choice of specific raw materials and technological innovation as well as raw material availability and its consuming pattern based on an assumption that stone raw materials were carefully transported and consumed to optimize mobility and technological strategies, depth of planning in landscape use and risk minimization [@brantingham2003neutral].

Umap: <- depending on whether we are gonna add umap (or PCA) analysis result 



# Results

Elevation of occupied sites

The result of the elevation change of 33 cultural layers from 22 sites corresponding to the targeting period shows that there is no remarkable change can be seen in site elevation during the transition (Fig.1: with no sp site distinction). We applied the existence of the stemmed points to the elevation to understand the benefit of having the points in the toolkit and the result indicates that the hunter-gathering groups who carried the technology could occupy higher altitude while the groups with no points stayed at the lower altitude (Fig. 2: distinction between sites with no stemmed points and with stemmed points). 

```{r}
# site elevation

mydata <- korean_archaeological_sites

mydata_ages <- 
  mydata %>% 
  separate(`C14(BP)`, into = c('age', 'error'),
          sep = "±") %>% 
  mutate(age_ka = parse_number(age) / 1000,
         error = parse_number(error),
         `altitude(m)_of_main_layer` = parse_number(`altitude(m)_of_main_layer`)) %>% 
  mutate(has_sp = ifelse(!is.na(`SP#`), "yes", "no"))

ggplot(mydata_ages, 
       aes(x = age_ka,
           y = `altitude(m)_of_main_layer`,
       color = as.factor(has_sp))) +
  geom_point(size = 3) +
  xlab("Age of occupation (ka)") +
  ylab("Elevation above sea level (m)") +
  geom_smooth(se = FALSE) +
  scale_colour_discrete(name = "Contains\nstemmed\npoints?") +
  theme_minimal(base_size = 16) 
```

Artifact density and Composition of toolkit

During the transitional period, the artifact volumetric density was relatively small but it becomes higher around 30 ka (Fig. 3: the transition of artifact volumetric density). When it comes to the composition of the toolkit, it is hardly recognized any pattern of changes over time (Fig. 4: the composition of toolkit). Both results with no information about raw material availability near the 22 sites, we assume that the artifact density might relate to the duration of site occupation or group size rather than portability and efficiency of tools. In other words, the small artifact density might indicate shorter duration or smaller group size. Likewise, the composition of toolkit might represent the characteristics or purpose of each site, rather than showing general pattern of chronological change.    


```{r}
#Volume and artefact counts to get density over time. 
kasv_tidy <- 
kasv %>% 
  t %>% 
  as_tibble() %>% 
  setNames(as.character(.[1,])) %>% 
  .[-1,] %>% 
  mutate_all(parse_number) %>% 
  mutate(artefact_density = total_artifacts / volume,
         sites = names(kasv)[-1])


ggplot(kasv_tidy,
       aes(date_age,
           artefact_density)) +
  geom_point(aes(size = total_artifacts)) +
  geom_text_repel(aes(label = sites),
                  nudge_x = 0.25, 
                  nudge_y = 0.25) +
  ylab("Artifact density") +
  xlab("Age of assemblage (ka)") +
  scale_size_continuous(name = "Total number\nof artifacts")  +
  theme_minimal(base_size = 16)

```

Artifact density and retouch <- maybe we need to add the result of retouch, separately 
We use the combination of the artifact density and retouch frequency as a proxy to identify the mobility and residential pattern of hunter-gatherers. The result shows that there is no clear pattern during the transition period and then it became more expedient at the end of the transition (Fig 5. The combination of artifact density and retouch). That is to say, the hunter-gatherer became either more residential or the majority of the site that this research studies were used as base camps or residence rather than shortly occupied camps for certain tasks. 


Summed probability distribution

To understand the population change during the appearance of stemmed points, we analyzed the summed probability distributions of 171 radiocarbon dates from 33 cultural layers and it indicates that there is a higher density of radiocarbon dates from around 34 ka. We could cautiously assume that the population flux might relate to the technological innovation. 

```{r}
dates_clean <- 
  dates %>% 
  mutate(age = parse_number(as.character(age)),
         error = parse_number(as.character(error))) %>% 
  filter(age < 50000, method=='AMS')

# devtools::install_github('ahb108/rcarbon')
library(rcarbon)
dates_calibrated <- 
  calibrate(x=dates_clean$age,
               errors=dates_clean$error,
               calCurves='intcal13')

dates_calibrated_spd <-  spd(dates_calibrated, timeRange = c( 45000, 1000))
plot(dates_calibrated_spd)

# Testing Observed SPDs against theoretical models
## recalibrate dates without normalisation to avoid artificial peaks
spd_dates<- calibrate(x=dates_clean$age,errors=dates_clean$error,normalised=FALSE,verbose=F) 

spd_test <- modelTest(spd_dates,errors=dates_clean$error,timeRange=c(45000,1000),model='exponential',nsim=200,ncores=3)

summary(spd_test)
plot(spd_test)
```


Raw materials

During the transition period, the use of shale and rhyolite greatly increased. These two raw materials are suitable to make elongate blades and stemmed points. It is considered that he hunter-gatherer started to use raw materials selectively depending on the type of tool, especially the newly produced stemmed points. Raw material availability is a crucial factor in determining the trip and direction for hunter-gatherers [@davies2018modeling]. Therefore the adoption of new raw material along with the emergence of new type of tools demonstrates a significant innovation in not just technology but also cognitive system.    

```{r}
#raw material information
kasr_long1 <- 
  kasr %>% 
  gather(site, 
         count, 
         -X) %>% 
  group_by(site) %>% 
  mutate(percentage = count / sum(count, na.rm = TRUE) * 100,
         total = sum(count, na.rm = TRUE)) %>% 
  filter(!is.na(percentage)) %>% 
  mutate(raw_material = ifelse(percentage >= 10, as.character(X), "other")) %>% 
  mutate(raw_material = ifelse(raw_material == "etc.", "other", raw_material)) %>% 
  select(-X)


  # if percentage is <10%, call it 'other'
kasr_long2 <- 
  kasr_long1 %>% 
  group_by(site, raw_material) %>% 
  summarise(percentage = sum(percentage)) %>% 
  ungroup() %>% 
  left_join(kasr_long1 %>% 
              select(site, raw_material, total),
            by = c('site', "raw_material")) %>% 
  distinct(.keep_all = TRUE) %>% 

  # join to get ages of the sites
  left_join(mydata_ages, 
            by = c('site' = 'site_name')) %>% 
  mutate(age_ka = jitter(age_ka),
         age_bin  = ntile(age_ka, 5)) %>% 
  arrange(age_ka) %>% 
  filter(!is.na(age_ka)) %>% 
    mutate(axis_label = glue('{site} ({round(age_ka,1)} ka, n = {total})')) 


ggplot(kasr_long2, 
       aes(
           reorder(axis_label, -age_ka),
           percentage,
           fill = raw_material)) +
  geom_col(position = "fill") +
  xlab("Assemblage (youngest at the top)") +
  ylab("Percentage") +
  scale_fill_viridis_d(name = "Raw material type",
                       option = "C") +
  coord_flip() +
  theme_minimal(base_size = 12) 

```
Umap


# Discussion 

1. The new technology and occupation in high elevation

The new technology appeared around 40-35ka in the Korean Peninsula includes stemmed points and following blade industry. The stemmed points brought new paradigms in stone artifact assemblages. For example, projectile points are only a part of composit artifacts and this specific characteristics could contribute to increase efficiency of maintaining the toolkit by easily replacing the damaged part [@kuhn2015artifacts; @cardillo2010some]. Combining with other materials increases utility or functionality of the tool by adding extra weight and providing a shaft, which makes it earlier to grip. Selective use of raw material might impact on hunter-gathers’ mobility and occupation pattern depending on availability of the specific raw materials such as shale and rhyolite. In addition, this research shows that carrying the points enabled hunter-gatherers to occupy higher elevation compared to the sites with no stemmed points. Therefore, we can assume that the technology would play an important role to survive in more risky environments. 

2. Population change

Interpreted in HBE, we expected there might be close connection between environmental change and the appearance of new technology based on the prediction that the new invention was the result of risk. The research suggests that the environmental pressure could be related to population change. We cannot simply predicate that the increased population around 35ka was due to dispersal of Homo Sapiens since there is no reliable human remains in South Korea. However, the migration of Homo sapiens was not impossible scenario at the same time. In fact, one model explains that the emergence of stemmed points and blade industry came from outside of the Korean peninsula and the new technology was the result of the continuous influx of modern human populations from Siberia while the earlier coarse flake trandition was come from southern China [@Bae_2010]. Since this migration model barely explains about preexisted stone artifact assemblages and people in the Korean Peninsula, it is hard to accept his argument without knowing about the native people. In short, we assume that the stemmed points appeared related to the increased population and it can be related to the modern human dispersal or indigenously increased occupants.        

3. Expedient vs curated

To monitor mobility strategies and site occupation pattern, we examined the artifact density and retouch frequency, based on the premise that highly mobile foragers would have light weighted, highly retouched, replaceable, almost completely made tools and leave small amount of artifacts when they move to the new location (curated). One the other hand, less mobile foragers who tend to stay in one place yield more debitage and debris, produce less efficient tools since they can easily get supplied (expedient) [@clark2019landscapes; @kuhn1994formal; @kuhn2014mousterian; @meignen2006middle]. Therefore, the curated technology indicates sites with special or highly mobile groups with stone artifacts that are thoroughly designed and based on a high level of investment of time and effort in artifact manufacture and maintenance. The expedient technology represents base camp or residence with artifacts that tend to be manufactured, used, and abandoned in the short period of time [@vaquero2018searching;@binford1979organization; @torrence1989time]. There appear to be more variety in the type of sites (or group) during the transition period, both expedient or curated. It became more expedient at the end of the transition, which means foragers became less mobile and tended to stay in the base camp. Combined with the result of population dynamics, we can assume that the increased population made each group bigger and let them stay in one place. 

# Conclusion 

This research aims to understand how the appearance of new technology affected hunter-gatherers in Korea and answer the three questions, how did the introduction of the new tools change the way people used the landscape, the way people used sites, and the population. To answer the question, we use HBE as a theoretical backgrounds and analyze stone artifacts from 22 sites dated before and after 40-35ka. The new technology is represented the stemmed points and other blade industry made out of new raw materials such as shale and rhyolite. We could clearly see that hunter-gatherers chose these materials particularly to make the newly added stone artifacts to the toolkit. The results also show that the new technology enables the occupation of marginal environments at higher elevations. Besides of technological change, we found that there are more varieties in the type of sites or groups during the transition period, both curated and expedient and then it becomes more expedient. In other words, the foragers became less mobile and prone to stay in one place after the transition ended. We expected to see any pattern that would explain the relationship between environmental change and the emergence of the new technology. However, there was not enough paleoenvironmental information as well as data to apply to verify the model. Therefore we focus on Radiocarbon dates as a proxy of population change based on the premise that population driven pressure could trigger people to invent a new tool. The results show that population dynamics might have had more impact on changes in stone artifact technology. 


------------NOT WORKING-------------

```{r}
#the artifact composition of each sites to figure out what people did as they were occupying the sites.
kasa_long <-
  kasa %>%
  gather(site, 
         count, 
         -X) %>% 
  filter(!is.na(count)) %>% 
  group_by(site) %>% 
  mutate(percentage = count / sum(count, na.rm = TRUE) * 100,
         total = sum(count, na.rm = TRUE)) %>% 
  filter(!is.na(percentage)) %>% 
  # if percentage is <10%, call it 'other'
  mutate(artefact_type = ifelse(as.character(X) == 'stemmed_point',
                                'stemmed_point', 
                                ifelse(percentage >= 10, 
                                as.character(X), "other_tools"))) %>% 
  mutate(axis_label = glue('{site}\n(n = {total})'))  %>% 
  # join to get ages of the sites
  left_join(mydata_ages, 
            by = c('site' = 'site_name')) %>% 
  arrange(age_ka) %>% 
   mutate(age_ka = jitter(age_ka))

ggplot(kasa_long, 
       aes(age_ka, 
           percentage,
           fill = artefact_type)) +
  geom_col() +
  ylab("Percentage") +
  xlab("Age of assemblage (ka)") +
  labs(fill="Artifact type")+
  theme_minimal(base_size = 16) 

```

Get the lithic data for some sites:

```{r}
# we'll use googlesheets package to get the data more efficiently
library(googlesheets)

# here is the key to the google sheet: this ggole sheet is same as kasa. so I could do kas_sites <- kasa 
kas_sites <- gs_key("14G0Mp-YSsKBOBPF1Z1zPWQbZQ-sjJSWLetDIQSlbsjw")  

# get the tab names from this sheet: But that I couldn't use gs_ws_ls
kas_sites_names <- gs_ws_ls(kas_sites)

# sheets we need here
sheets <- c( "general_info",    "assemblage_info" )

# get the data from the tabs in this sheet!
kas_sites_sheets <- 
  map(sheets, ~kas_sites %>% gs_read_listfeed(ws = .x))
```

Compute artefact volumetric density by frequency of retouched piece (log scale), following Julien Riel-Salvatore and C. Michael Barton in  https://www.jstor.org/stable/4128419

```{r}
# put the site names on this list of data frames
site_names <-  kas_sites_sheets[[1]] %>%  
  select(-X1) %>% 
  names()

# density of arefacts at each site
artefact_density <- 
kas_sites_sheets[[1]] %>% 
  t %>% 
  as.data.frame() %>% 
 rownames_to_column() %>% 
  mutate_all(as.character) 

names(artefact_density) <- as.character(as.vector(artefact_density[1, ]))
artefact_density <- artefact_density[-1,]

artefact_density <- 
artefact_density %>% 
  mutate(density = as.numeric(total_artifacts) / as.numeric(volume)) %>% 
   mutate_at(2:ncol(.), as.numeric)  

# frequency of retouched artefacts
retouched_artefacts <- 
 kas_sites_sheets[[2]] %>% 
   filter(!X1 %in% c("debris", 
                     "unkown", 
                     "pebble",  
                     "metate", 
                     "flake",
                     "unfinished",
                     "ground",
                     "blank"
                     )) %>% 
    t %>% 
  as.data.frame() %>% 
 rownames_to_column() %>% 
  mutate_all(as.character) 

names(retouched_artefacts) <- as.character(as.vector(retouched_artefacts[1, ]))
retouched_artefacts <- retouched_artefacts[-1,]

retouched_artefacts <- 
retouched_artefacts %>% 
  mutate_at(2:ncol(.), as.numeric)  %>% 
  mutate(total_retouched = rowSums(.[,-1], na.rm = TRUE))


# join together the site age, artefact density df with the retouched artefacts df
kas_density_retouch_ages <- 
artefact_density %>% 
  left_join(retouched_artefacts) %>% 
  mutate(proportion_retouched = total_retouched / total_artifacts) %>% 
  mutate(sites = X1)

 
# compute correlation
kas_sites_retouch_density_corr <- 
cor.test(kas_density_retouch_ages$proportion_retouched,
         kas_density_retouch_ages$density)

r_value <- unname(kas_sites_retouch_density_corr$estimate)

```


```{r}
size <-  8


ggplot(kas_density_retouch_ages,
       aes(density,
           proportion_retouched
           )) +
  geom_point(aes(colour = date_age / 1000,
                 size = total_artifacts,
                 shape = is.na(stemmed_point))) +
 # geom_text_repel(aes(label = sites),
 #                 nudge_x = 0.075, 
 #                 nudge_y = -0.075,
 #                 size = 5) +
  geom_smooth(alpha = 0.2) +
  scale_y_log10(limits = c(0.001, 1),
                labels = scales::comma_format(accuracy = 0.001)) +
  scale_x_log10(limits = c(0.001, 10),
                labels = scales::comma_format(accuracy = 0.001)) +
  theme_minimal(base_size = 12) +
  scale_color_viridis_c(name = "Age of\nassemblage (ka)") +
  xlab("Artifact volumetric density") +
  ylab("Proportion of retouched pieces") +
  annotate("text",
           x = 0.005,
           y = 0.7,
           label = "Curated",
           size = size -2,
           colour = "grey50") +
    annotate("text",
           x = 5,
           y = 0.01,
           label = "Expedient",
           size = size -2,
           colour = "grey50") +
    annotate("text",
           x = 0.01,
           y = 0.01,
           label = glue('r = {round(r_value, 3)}'),
           size = size - 2,
           colour = "grey50")

```

```{r}
# I wanna make simple table for artifact density and frequency of retouched pieces again. Because the complex table above is hard to make comments..



ggplot(kas_density_retouch_ages,
       aes(density,
           proportion_retouched
           )) +
  geom_point(aes(colour = date_age / 1000,
                 size = 7)) +
 # geom_text_repel(aes(label = sites),
 #                 nudge_x = 0.075, 
 #                 nudge_y = -0.075,
 #                 size = 5) +
  geom_smooth(alpha = 0.2) +
  scale_y_log10(limits = c(0.001, 1),
                labels = scales::comma_format(accuracy = 0.001)) +
  scale_x_log10(limits = c(0.001, 10),
                labels = scales::comma_format(accuracy = 0.001)) +
  theme_minimal(base_size = 12) +
  scale_color_viridis_c(name = "Age of\nassemblage (ka)") +
  xlab("Artifact volumetric density") +
  ylab("Proportion of retouched pieces") +
  annotate("text",
           x = 0.005,
           y = 0.7,
           label = "Curated",
           size = size -2,
           colour = "grey50") +
    annotate("text",
           x = 5,
           y = 0.01,
           label = "Expedient",
           size = size -2,
           colour = "grey50") +
    annotate("text",
           x = 0.01,
           y = 0.01,
           label = glue('r = {round(r_value, 3)}'),
           size = size - 2,
           colour = "grey50")



```


Artefact volumetric density and frequency of retouched pieces can be proxies to identify the characteristics of the hunter-gatherers who carried that stone tools whether they are residentially mobile or logistically orgnized foragers based on the premise that the relationship between lithic assemblage composition and land-use strategy represent an expression of economizing behavior. 

The artefact volumetric density is defined as the total number of artefacts per cubic meter of excavated sediment, and served as a proxy for accumulation ratio of artefacts. the relative frequency of retouched pieces is the count of retouched flake tools devided by the total number of artifacts. 

The two ends of the curated-expedient show that residential to logistical mobility. Expedient assemblages can be depicted as "base camps" or "residences", while curated ones represent either residential mobility, where the central locus of group changes frequently, or certain task groups from a central residential site. 

The plot show that younger sites are likely to be used as base camp than older site, which means that people tended to stay longer at one place after around 40-35ka. 

(Riel-Salvatore and Barton 2004)


```{r}
# dating
library(rcarbon)

# I'm working through https://cran.r-project.org/web/packages/rcarbon/vignettes/rcarbon.html

kas_ages <- 
kas_density_retouch_ages %>% 
  select(sites, date_age, date_error) %>% 
  mutate(sites = str_remove_all(sites, "_"))

kas_caldates <- 
  calibrate(x = kas_ages$date_age,
            errors = kas_ages$date_error,
            calCurves='intcal13',
            ncores=3) #running calibration over 3 cores

kas_spd = spd(kas_caldates, timeRange = c(50000,25000)) 
plot(kas_spd)

binsense(x=kas_caldates,
         y=kas_ages$sites,
         h=seq(0,5000,100),
         timeRange=c(50000,25000)) 

ggplot(kas_spd$grid,
       aes(calBP,
           PrDens)) +
  geom_line() +
  scale_y_log10(name = "Summed probability")


# test how the SPD fits to an exponential growth model:
expnull <- modelTest(kas_caldates, 
                     errors=kas_ages$date_error, 
                     nsim=100, 
                     timeRange=c(50000,25000),
                     model="uniform",
                     runm=10)

plot(expnull)

```

# Acknowledgements

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
git2r::repository(here::here())
```
